!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.grapheneWS=e()}}(function(){var e;return function e(n,t,o){function r(c,s){if(!t[c]){if(!n[c]){var a="function"==typeof require&&require;if(!s&&a)return a(c,!0);if(i)return i(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[c]={exports:{}};n[c][0].call(l.exports,function(e){var t=n[c][1][e];return r(t?t:e)},l,l.exports,e,n,t,o)}return t[c].exports}for(var i="function"==typeof require&&require,c=0;c<o.length;c++)r(o[c]);return r}({1:[function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o,r=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=e("./ChainWebSocket"),c=e("./GrapheneApi"),s=e("./ChainConfig");n.exports={setRpcConnectionStatusCallback:function(e){this.statusCb=e,o&&o.setRpcConnectionStatusCallback(e)},instance:function(){var e=arguments.length<=0||void 0===arguments[0]?"ws://localhost:8090":arguments[0];return o||(o=new a,o.setRpcConnectionStatusCallback(this.statusCb),o.connect(e)),o},chainId:function(){return Apis.instance().chain_id},close:function(){o.close(),o=null}};var a=function(){function e(){t(this,e)}return r(e,[{key:"connect",value:function(e){var n=this,t="",o="";if("undefined"!=typeof window&&window.location&&"https:"===window.location.protocol&&e.indexOf("wss://")<0)throw new Error("Secure domains require wss connection");this.ws_rpc=new i(e,this.statusCb),this.init_promise=this.ws_rpc.login(t,o).then(function(){n._db=new c(n.ws_rpc,"database"),n._net=new c(n.ws_rpc,"network_broadcast"),n._hist=new c(n.ws_rpc,"history"),n._crypt=new c(n.ws_rpc,"crypto");var e=n._db.init().then(function(){return n._db.exec("get_chain_id",[]).then(function(e){return n.chain_id=e,s.setChainId(e)})});return n.ws_rpc.on_reconnect=function(){n.ws_rpc.login("","").then(function(){n._db.init().then(function(){n.statusCb&&n.statusCb("reconnect")}),n._net.init(),n._hist.init(),n._crypt.init()})},Promise.all([e,n._net.init(),n._hist.init(),n._crypt.init().catch(function(e){return console.error("ApiInstance	Crypto API Error",e)})])})}},{key:"close",value:function(){this.ws_rpc.close(),this.ws_rpc=null}},{key:"db_api",value:function(){return this._db}},{key:"network_api",value:function(){return this._net}},{key:"history_api",value:function(){return this._hist}},{key:"crypto_api",value:function(){return this._crypt}},{key:"setRpcConnectionStatusCallback",value:function(e){this.statusCb=e}}]),e}()},{"./ChainConfig":2,"./ChainWebSocket":3,"./GrapheneApi":4}],2:[function(e,n){(function(e){"use strict";var t,o={address_prefix:e.env.npm_config__graphene_ecc_default_address_prefix||"GPH"};n.exports=t={core_asset:"CORE",address_prefix:"GPH",expire_in_secs:15,expire_in_secs_proposal:86400,networks:{BitShares:{core_asset:"BTS",address_prefix:"BTS",chain_id:"4018d7844c78f6a6c41c6a552b898022310fc5dec06da467ee7905a8dad512c8"},Muse:{core_asset:"MUSE",address_prefix:"MUSE",chain_id:"45ad2d3f9ef92a49b55c2227eb06123f613bb35dd08bd876f2aea21925a67a67"},Test:{core_asset:"TEST",address_prefix:"TEST",chain_id:"39f5e2ede1f8bc1a3a54a7914414e3779e33193f1f5693510e73cb7a87617447"}},setChainId:function(e){var n,r,i,c,s;for(s=Object.keys(t.networks),n=0,r=s.length;r>n;n++)if(c=s[n],i=t.networks[c],i.chain_id===e)return t.network_name=c,i.address_prefix&&(t.address_prefix=i.address_prefix,o.address_prefix=i.address_prefix),{network_name:c,network:i};t.network_name||console.log("Unknown chain id (this may be a testnet)",e)},reset:function(){t.core_asset="CORE",t.address_prefix="GPH",o.address_prefix="GPH",t.expire_in_secs=15,t.expire_in_secs_proposal=86400,console.log("Chain config reset")},setPrefix:function(){var e=arguments.length<=0||void 0===arguments[0]?"GPH":arguments[0];t.address_prefix=e,o.address_prefix=e}}}).call(this,e("_process"))},{_process:7}],3:[function(e,n){(function(t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=void 0;"undefined"!=typeof WebSocket||t.env.browser?"undefined"!=typeof WebSocket&&(i=e("ReconnectingWebSocket")):i=e("websocket").w3cwebsocket;var c=!1,s=function(){function e(n,t){var r=this;o(this,e),this.statusCb=t;try{this.ws=new i(n)}catch(e){console.error("invalid websocket URL:",e),this.ws=new i("wss://127.0.0.1:8080")}this.ws.timeoutInterval=5e3,this.current_reject=null,this.on_reconnect=null,this.connect_promise=new Promise(function(e,n){r.current_reject=n,r.ws.onopen=function(){r.statusCb&&r.statusCb("open"),r.on_reconnect&&r.on_reconnect(),e()},r.ws.onerror=function(e){r.statusCb&&r.statusCb("error"),r.current_reject&&r.current_reject(e)},r.ws.onmessage=function(e){return r.listener(JSON.parse(e.data))},r.ws.onclose=function(){r.statusCb&&r.statusCb("closed")}}),this.cbId=0,this.cbs={},this.subs={},this.unsub={}}return r(e,[{key:"call",value:function(e){var n=this,t=e[1];if(c&&console.log('[ChainWebSocket] >---- call ----->  "id":'+(this.cbId+1),JSON.stringify(e)),this.cbId+=1,("set_subscribe_callback"===t||"subscribe_to_market"===t||"broadcast_transaction_with_callback"===t||"set_pending_transaction_callback"===t)&&(this.subs[this.cbId]={callback:e[2][0]},e[2][0]=this.cbId),"unsubscribe_from_market"===t||"unsubscribe_from_accounts"===t){if("function"!=typeof e[2][0])throw new Error("First parameter of unsub must be the original callback");var o=e[2].splice(0,1)[0];for(var r in this.subs)if(this.subs[r].callback===o){this.unsub[this.cbId]=r;break}}var i={method:"call",params:e};return i.id=this.cbId,new Promise(function(e,t){n.cbs[n.cbId]={time:new Date,resolve:e,reject:t},n.ws.onerror=function(e){console.log("!!! ChainWebSocket Error ",e),t(e)},n.ws.send(JSON.stringify(i))})}},{key:"listener",value:function(e){c&&console.log("[ChainWebSocket] <---- reply ----<",JSON.stringify(e));var n=!1,t=null;"notice"===e.method&&(n=!0,e.id=e.params[0]),t=n?this.subs[e.id].callback:this.cbs[e.id],t&&!n?(e.error?t.reject(e.error):t.resolve(e.result),delete this.cbs[e.id],this.unsub[e.id]&&(delete this.subs[this.unsub[e.id]],delete this.unsub[e.id])):t&&n?t(e.params[1]):console.log("Warning: unknown websocket response: ",e)}},{key:"login",value:function(e,n){var t=this;return this.connect_promise.then(function(){return t.call([1,"login",[e,n]])})}},{key:"close",value:function(){this.ws.close()}}]),e}();n.exports=s}).call(this,e("_process"))},{ReconnectingWebSocket:5,_process:7,websocket:6}],4:[function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),r=function(){function e(n,o){t(this,e),this.ws_rpc=n,this.api_name=o}return o(e,[{key:"init",value:function(){var e=this;return this.ws_rpc.call([1,this.api_name,[]]).then(function(n){return e.api_id=n,e})}},{key:"exec",value:function(e,n){return this.ws_rpc.call([this.api_id,e,n]).catch(function(t){throw console.log("!!! GrapheneApi error: ",e,n,t,JSON.stringify(t)),t})}}]),e}();n.exports=r},{}],5:[function(n,t){!function(n,o){"function"==typeof e&&e.amd?e([],o):"undefined"!=typeof t&&t.exports?t.exports=o():n.ReconnectingWebSocket=o()}(this,function(){function e(n,t,o){function r(e,n){var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,n),t}var i={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"};o||(o={});for(var c in i)this[c]="undefined"!=typeof o[c]?o[c]:i[c];this.url=n,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var s,a=this,u=!1,l=!1,f=document.createElement("div");f.addEventListener("open",function(e){a.onopen(e)}),f.addEventListener("close",function(e){a.onclose(e)}),f.addEventListener("connecting",function(e){a.onconnecting(e)}),f.addEventListener("message",function(e){a.onmessage(e)}),f.addEventListener("error",function(e){a.onerror(e)}),this.addEventListener=f.addEventListener.bind(f),this.removeEventListener=f.removeEventListener.bind(f),this.dispatchEvent=f.dispatchEvent.bind(f),this.open=function(n){if(s=new WebSocket(a.url,t||[]),s.binaryType=this.binaryType,n){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else f.dispatchEvent(r("connecting")),this.reconnectAttempts=0;(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",a.url);var o=s,i=setTimeout(function(){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",a.url),l=!0,o.close(),l=!1},a.timeoutInterval);s.onopen=function(){clearTimeout(i),(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",a.url),a.protocol=s.protocol,a.readyState=WebSocket.OPEN,a.reconnectAttempts=0;var t=r("open");t.isReconnect=n,n=!1,f.dispatchEvent(t)},s.onclose=function(t){if(clearTimeout(i),s=null,u)a.readyState=WebSocket.CLOSED,f.dispatchEvent(r("close"));else{a.readyState=WebSocket.CONNECTING;var o=r("connecting");o.code=t.code,o.reason=t.reason,o.wasClean=t.wasClean,f.dispatchEvent(o),n||l||((a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",a.url),f.dispatchEvent(r("close")));var i=a.reconnectInterval*Math.pow(a.reconnectDecay,a.reconnectAttempts);setTimeout(function(){a.reconnectAttempts++,a.open(!0)},i>a.maxReconnectInterval?a.maxReconnectInterval:i)}},s.onmessage=function(n){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",a.url,n.data);var t=r("message");t.data=n.data,f.dispatchEvent(t)},s.onerror=function(n){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",a.url,n),f.dispatchEvent(r("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(n){if(s)return(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",a.url,n),s.send(n);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,n){"undefined"==typeof e&&(e=1e3),u=!0,s&&s.close(e,n)},this.refresh=function(){s&&s.close()}}if("WebSocket"in window)return e.prototype.onopen=function(){},e.prototype.onclose=function(){},e.prototype.onconnecting=function(){},e.prototype.onmessage=function(){},e.prototype.onerror=function(){},e.debugAll=!1,e.CONNECTING=WebSocket.CONNECTING,e.OPEN=WebSocket.OPEN,e.CLOSING=WebSocket.CLOSING,e.CLOSED=WebSocket.CLOSED,e})},{}],6:[function(){},{}],7:[function(e,n){function t(){f&&c&&(f=!1,c.length?l=c.concat(l):d=-1,l.length&&o())}function o(){if(!f){var e=a(t);f=!0;for(var n=l.length;n;){for(c=l,l=[];++d<n;)c&&c[d].run();d=-1,n=l.length}c=null,f=!1,u(e)}}function r(e,n){this.fun=e,this.array=n}function i(){}var c,s=n.exports={},a=setTimeout,u=clearTimeout,l=[],f=!1,d=-1;s.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];l.push(new r(e,n)),1!==l.length||f||a(o,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=i,s.addListener=i,s.once=i,s.off=i,s.removeListener=i,s.removeAllListeners=i,s.emit=i,s.binding=function(){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}]},{},[1])(1)});